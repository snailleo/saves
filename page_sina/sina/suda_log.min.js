 /**
 * 新浪数据采集
 * @fileoverview suda_log统计
 * @author wangfeng@staff.sina.com.cn
 * @date 2015-01-28
 */
(function(){function d(e){if(typeof window.onload=="function"){var f=window.onload;window.onload=function(){f();e()}}else{window.onload=e}}var a="",c=new Date().getTime();function b(){if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){a=new Date().getTime();document.removeEventListener("DOMContentLoaded",arguments.callee,false)},false)}else{if(document.getElementById){document.write('<script id="ie-domReady" defer=\'defer\'src="//:"><\/script>');document.getElementById("ie-domReady").onreadystatechange=function(){if(this.readyState==="complete"){a=new Date().getTime();this.onreadystatechange=null;this.parentNode.removeChild(this)}}}}}b();d(function(){var aa=window,p=document,C=navigator,Z=C.userAgent,r=aa.screen,u=aa.location.href;var Y="https:"==aa.location.protocol?"https://":"http://",z="beacon.sina.com.cn";var s=Y+z+"/a.gif?",j=Y+z+"/e.gif?";var n="",ad="";startTime="",readyTime="";currTime=parseInt(new Date().getTime());var g="",y=u.split("?")[1];if(!!y&&u.indexOf("wm=")>0){var h=y.split("&"),F=h.length;for(var af=0;af<F;af++){var M=h[af].split("=");if(M[0]=="wm"){g=M[1];break}}}if(g){var l=m("wm");if(g!=l){v("wm",g,"","sina.cn")}}g=m("wm");if(typeof sudaLogConfig!=="undefined"){n=sudaLogConfig.uId!==undefined?sudaLogConfig.uId:"";ad=sudaLogConfig.url!==undefined?sudaLogConfig.url:"";if(typeof globalConfig!=="undefined"){startTime=globalConfig.startTime!==undefined?globalConfig.startTime:c}}onloadTime=currTime-startTime;readyTime=a-startTime;var I="MT=";I+="wm:"+g;if(typeof sudaLogConfig!=="undefined"&&typeof sudaLogConfig.prevPageClickTime!=="undefined"&&sudaLogConfig.prevPageClickTime!==""){var V=sudaLogConfig.prevPageClickTime!==undefined?sudaLogConfig.prevPageClickTime:0,S=startTime-V;I+="|mperform:1|starttime:"+V+"|endtime:"+startTime+"|clicktime:"+S}var R=p.referrer.toLowerCase();var G="SINAGLOBAL",f="Apache",ac="ULV",q="SUP";var ab="";var K="",J="";var o=[],W=[];var ai=0,aj=0;function T(al,D){var ak=p.getElementsByName(al);var i=(D>0)?D:0;return(ak.length>i)?ak[i].content:""}function x(){var an=p.getElementsByName("sudameta");var ao=[];for(var D=0;D<an.length;D++){var am=an[D].content;if(am){if(am.indexOf(";")!=-1){var ap=am.split(";");for(var al=0;al<ap.length;al++){var ak=e(ap[al]);if(!ak){continue}ao.push(ak)}}else{ao.push(am)}}}return ao}function ae(an,D,al,ak){if(an==""){return""}ak=(ak=="")?"=":ak;D+=ak;var am=an.indexOf(D);if(am<0){return""}am+=D.length;var i=an.indexOf(al,am);if(i<am){i=an.length}return an.substring(am,i)}function m(i){if(undefined==i||""==i){return""}return ae(p.cookie,i,";","")}function v(am,i,D,al){if(i!=null){if((undefined==al)||(null==al)){al="sina.cn"}if((undefined==D)||(null==D)||(""==D)){p.cookie=am+"="+i+";domain="+al+";path=/"}else{var ak=new Date();var an=ak.getTime();an=an+86400000*D;ak.setTime(an);an=ak.getTime();p.cookie=am+"="+i+";domain="+al+";expires="+ak.toUTCString()+";path=/"}}}function t(i,al,ak){var D=i;if(D==null){return false}al=al||"click";if((typeof ak).toLowerCase()!="function"){return}if(D.attachEvent){D.attachEvent("on"+al,ak)}else{if(D.addEventListener){D.addEventListener(al,ak,false)}else{D["on"+al]=ak}}return true}function ah(){if(window.event!=null){return window.event}else{if(window.event){return window.event}var D=arguments.callee.caller;var i;var ak=0;while(D!=null&&ak<40){i=D.arguments[0];if(i&&(i.constructor==Event||i.constructor==MouseEvent||i.constructor==KeyboardEvent)){return i}ak++;D=D.caller}return i}}function ag(i){i=i||ah();if(!i.target){i.target=i.srcElement;i.pageX=i.x;i.pageY=i.y}if(typeof i.layerX=="undefined"){i.layerX=i.offsetX}if(typeof i.layerY=="undefined"){i.layerY=i.offsetY}return i}function e(al){if(typeof al!=="string"){throw"trim need a string as parameter"}var i=al.length;var ak=0;var D=/(\u3000|\s|\t|\u00A0)/;while(ak<i){if(!D.test(al.charAt(ak))){break}ak+=1}while(i>ak){if(!D.test(al.charAt(i-1))){break}i-=1}return al.slice(ak,i)}function L(i){return Object.prototype.toString.call(i)==="[object Array]"}function P(al,ap){var ar=e(al).split("&");var aq={};var ak=function(i){if(ap){return decodeURIComponent(i)}else{return i}};for(var an=0,ao=ar.length;an<ao;an++){if(ar[an]){var am=ar[an].split("=");var D=am[0];var at=am[1];if(am.length<2){at=D;D="$nullName"}if(!aq[D]){aq[D]=ak(at)}else{if(L(aq[D])!=true){aq[D]=[aq[D]]}aq[D].push(ak(at))}}}return aq}function Q(D){var i=new RegExp("^http(?:s)?://([^/]+)","im");if(D.match(i)){return D.match(i)[1].toString()}else{return""}}var B={screenSize:function(){return r.width+"x"+r.height},colorDepth:function(){return r.colorDepth||""},appCode:function(){return C.appCodeName||""},appName:function(){return(C.appName.indexOf("Microsoft Internet Explorer")>-1)?"MSIE":C.appName},cpu:function(){return C.cpuClass||C.oscpu||""},platform:function(){return C.platform||""},jsVer:function(){var am,i,ao,ak=1,al=0,D=(C.appName.indexOf("Microsoft Internet Explorer")>-1)?"MSIE":C.appName,an=C.appVersion;if("MSIE"==D){i="MSIE";am=an.indexOf(i);if(am>=0){ao=window.parseInt(an.substring(am+5));if(3<=ao){ak=1.1;if(4<=ao){ak=1.3}}}}else{if(("Netscape"==D)||("Opera"==D)||("Mozilla"==D)){ak=1.3;i="Netscape6";am=an.indexOf(i);if(am>=0){ak=1.5}}}return ak},network:function(){var i="";i=(C.connection&&C.connection.type)?C.connection.type:i;try{p.body.addBehavior("#default#clientCaps");i=p.body.connectionType}catch(D){i="unkown"}return i},language:function(){return C.systemLanguage||C.language||""},timezone:function(){return new Date().getTimezoneOffset()/60||""},flashVer:function(){return""},javaEnabled:function(){var ak=C.plugins,D=C.javaEnabled(),al,am;if(D==true){return 1}if(ak&&ak.length){for(var i in ak){al=ak[i];if(al.description==null){continue}if(D!=null){break}am=al.description.toLowerCase();if(am.indexOf("java plug-in")!=-1){D=parseInt(al.version);continue}}}else{if(window.ActiveXObject){D=(new ActiveXObject("JavaWebStart.IsInstalled")!=null)}}return D?1:0}};var k={pageId:function(){return""},sessionCount:function(){return""},excuteCount:function(){return SUDA.sudaCount},referrer:function(){var i=/^[^\?&#]*.swf([\?#])?/;if((R=="")||(R.match(i))){var D=ae(u,"ref","&","");if(D!=""){return escape(D)}}return escape(R)},isHomepage:function(){var D="";try{p.body.addBehavior("#default#homePage");D=p.body.isHomePage(u)?"Y":"N"}catch(i){D="unkown"}return D},PGLS:function(){return T("stencil")||""},ZT:function(){var i=T("subjectid");i.replace(",",".");i.replace(";",",");return escape(i)},mediaType:function(){return T("mediaid")||""},domCount:function(){return p.getElementsByTagName("*").length||""},iframeCount:function(){return p.getElementsByTagName("iframe").length},onloadTime:onloadTime,readyTime:readyTime,webUrl:ad};var O={visitorId:function(){if(""!=G){var i=m(G);if(""==i){i=m(f);var D=3650;v(G,i,D)}return i}else{return""}},sessionId:function(){var i=m(f);if(i==""){var D=new Date();i=Math.random()*10000000000000+"."+D.getTime();v(f,i)}return i},flashCookie:function(i){return""},lastVisit:function(){var ak=m(f);var am=m(ac);var al=am.split(":");var an="",D;if(al.length>=6){if(ak!=al[4]){D=new Date();var i=new Date(window.parseInt(al[0]));al[1]=window.parseInt(al[1])+1;if(D.getMonth()!=i.getMonth()){al[2]=1}else{al[2]=window.parseInt(al[2])+1}if(((D.getTime()-i.getTime())/86400000)>=7){al[3]=1}else{if(D.getDay()<i.getDay()){al[3]=1}else{al[3]=window.parseInt(al[3])+1}}an=al[0]+":"+al[1]+":"+al[2]+":"+al[3];al[5]=al[0];al[0]=D.getTime();v(ac,al[0]+":"+al[1]+":"+al[2]+":"+al[3]+":"+ak+":"+al[5],360)}else{an=al[5]+":"+al[1]+":"+al[2]+":"+al[3]}}else{D=new Date();an=":1:1:1";v(ac,D.getTime()+an+":"+ak+":",360)}return an},userNick:function(){if(ab!=""){return ab}var ak=unescape(m(q)),D="",i="",am=n,an="",al="";if(ak!=""){D=ae(ak,"ag","&","");i=ae(ak,"user","&","");n=ae(ak,"uid","&","");an=ae(ak,"sex","&","");al=ae(ak,"dob","&","")}ab=D+":"+i+":"+am+":"+an+":"+al;return ab},userOrigin:function(){return""},advCount:function(){return""},subp:function(){return m("SUBP")}};var w={CI:function(){var i=["sz:"+B.screenSize(),"dp:"+B.colorDepth(),"ac:"+B.appCode(),"an:"+B.appName(),"cpu:"+B.cpu(),"pf:"+B.platform(),"jv:"+B.jsVer(),"ct:"+B.network(),"lg:"+B.language(),"tz:"+B.timezone(),"fv:"+B.flashVer(),"ja:"+B.javaEnabled()];return"CI="+i.join("|")},PI:function(D){var ak=k.webUrl;if(!!D){ak=escape(D)}var i=["pid:"+k.pageId(),"st:"+k.sessionCount(),"et:"+k.excuteCount(),"ref:"+k.referrer(),"hp:"+k.isHomepage(),"PGLS:"+k.PGLS(),"ZT:"+k.ZT(),"MT:"+k.mediaType(),"keys:","dom:"+k.domCount(),"ifr:"+k.iframeCount(),"nld:"+k.onloadTime,"drd:"+k.readyTime,"url:"+ak];return"PI="+i.join("|")},UI:function(){var i=["vid:"+O.visitorId(),"sid:"+O.sessionId(),"lv:"+O.lastVisit(),"un:"+O.userNick(),"uo:"+O.userOrigin(),"ae:"+O.advCount(),"su:"+O.subp(),"lu:","si:","rs:"+0,"dm:"+0];return"UI="+i.join("|")},EX:function(D,i){D=(null!=D)?D||"":K;i=(null!=i)?i||"":J;return"EX=ex1:"+D+"|ex2:"+i},MT:function(){return I},V:function(){return"V=2.3.1"},R:function(){return"gUid_"+new Date().getTime()}};function X(i){E(i)}function E(D){var i=new Image();SUDA.img=i;i.src=D}function A(ak,D,al){SUDA.sudaCount++;var i=s+[w.V(),w.CI(),w.PI(al),w.UI(),w.MT(),w.EX(ak,D),w.R()].join("&");E(i)}function U(D,i,ak){if(SUDA.sudaCount!=0){return}A(D,i,ak)}function N(am,i,D){if(!D){D=""}else{D=escape(D)}var al="UATrack||"+m(G)+"||"+m(f)+"||"+O.userNick()+"||"+am+"||"+i+"||"+k.referrer()+"||"+D+"||";var ak=j+al+"&gUid_"+new Date().getTime();X(ak)}function H(am){var i=ag(am);var ak=i.target;var an="",D="";var al;if(ak!=null&&ak.getAttribute&&(!ak.getAttribute("suda-uatrack")&&!ak.getAttribute("suda-data"))){while(ak!=null&&ak.getAttribute&&(!!ak.getAttribute("suda-uatrack")||!!ak.getAttribute("suda-data"))==false){if(ak==p.body){return}ak=ak.parentNode}}if(ak==null||ak.getAttribute==null){return}an=ak.getAttribute("suda-uatrack")||ak.getAttribute("suda-data")||"";if(an){al=P(an);if(ak.tagName.toLowerCase()=="a"){D=ak.href}al.key&&SUDA.uaTrack&&SUDA.uaTrack(al.key,al.value||al.key,D)}}window.SUDA=window.SUDA||[];SUDA.sudaCount=SUDA.sudaCount||0;SUDA.log=function(){A.apply(null,arguments)};SUDA.uaTrack=function(){N.apply(null,arguments)};t(p.body,"click",H);U()})})();
